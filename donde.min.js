/*!
 * Copyright 2013 Agustin Diaz @hiroagustin
 * MIT license
 */
(function(){var b={idMap:"map",defaultLocation:{latitude:-34.8937720817105,longitude:-56.1659574508667}};
var a=function a(c){this.options=_.extend({},b,c);this.markers=this.options.markers;return this;};_.extend(a.prototype,{createMap:function(c){return new google.maps.Map(c,{mapTypeId:google.maps.MapTypeId.ROADMAP,streetViewControl:false,mapTypeControl:false,zoom:15});
},createMarker:function(c){c=c||{};return new google.maps.Marker({icon:c.icon,map:this.map,position:new google.maps.LatLng(c.latitude,c.longitude)});},setInitialPosition:function(d){var c=new google.maps.LatLng(d.latitude,d.longitude);
this.initialPosition=c;this.map.setCenter(c);this.userLocationMarker.setPosition(c);return this;},handleInitialLocationError:function(){this.setInitialPosition(this.options.defaultLocation);
this.options.errorMessage&&alert(this.options.errorMessage);console.log("Initial location not found.");return this;},panToPosition:function(c){if(!(c instanceof google.maps.LatLng)){c=new google.maps.LatLng(c.latitude,c.longitude);
}this.map.panTo(c);return this;},panToInitialPosition:function(){this.panToPosition(this.initialPosition);return this;},addMarker:function(c){if(!(c.type in this.groups)){this.groups[c.type]={};
}if(!this.groups[c.type].markers){this.groups[c.type].markers=[];}c.icon=this.groups[c.type].icon;this.groups[c.type].markers.push(this.createMarker(c));
return this;},getUserPosition:function(){var c=this;navigator.geolocation.getCurrentPosition(function(d){c.setInitialPosition(d.coords);},function(){c.handleInitialLocationError(arguments);
},{enableHighAccuracy:true,timeout:8000});return this;},addMarkers:function(){var c=this;if(!this.markers){console.log("No markers found.");}_.each(this.markers,function(d){c.addMarker(d);
});return this;},createIcons:function(){var c=this;_.each(this.options.icons,function(e,d){if(!(d in c.groups)){c.groups[d]={};}c.groups[d].icon=new google.maps.MarkerImage(c.options.icons[d],null,null,null,new google.maps.Size(37,34));
});return this;},init:function(){if(document.getElementById(this.options.idMap)){this.map=this.createMap(document.getElementById(this.options.idMap));this.userLocationMarker=this.createMarker();
this.userLocationMarker.setClickable(false);this.groups={};if("geolocation" in navigator){this.getUserPosition();}else{this.handleInitialLocationError();
}this.createIcons();this.addMarkers();}else{console.error("Map placeholder not found.");}return this;}});window.Donde=a;}());